/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/7.4.1/userguide/building_java_projects.html
 */

plugins {
    id 'application'
    id 'org.springframework.boot' version '2.6.4'
    id 'io.spring.dependency-management' version '1.0.11.RELEASE'
}

repositories {
	mavenLocal()
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

group = 'com.orbital3d.server.fnet'
version = '2.1.2-SNAPSHOT'
sourceCompatibility = '11'

dependencies {
    implementation 'org.springframework.boot:spring-boot-dependencies:2.6.7'
    implementation 'org.springframework.boot:spring-boot-starter'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-jetty:2.7.2'
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-log4j2'
    implementation 'org.mariadb.jdbc:mariadb-java-client:3.0.4'
    implementation 'org.javassist:javassist:3.28.0-GA'
    implementation 'org.apache.commons:commons-lang3:3.12.0'
    implementation 'org.apache.tika:tika-core:2.3.0'
    implementation group: 'org.hibernate', name: 'hibernate-c3p0', version: '5.6.4.Final'
	implementation group: 'com.mchange', name: 'c3p0', version: '0.9.5.2'
	implementation group: 'javax.validation', name: 'validation-api', version: '2.0.1.Final'
	implementation 'org.apache.commons:commons-collections4:4.1'
	compileOnly 'org.projectlombok:lombok:1.18.24'
	annotationProcessor 'org.projectlombok:lombok:1.18.24'
	
	// Weblectric Fence
	implementation 'com.orbital3d.web.security:we-core:0.2-SNAPSHOT'
	implementation 'com.orbital3d.web.security:we-spring-boot-starter:0.2-SNAPSHOT'
	
    // Use JUnit Jupiter for testing.
    testImplementation 'org.junit.jupiter:junit-jupiter:5.8.1'
	testCompileOnly 'org.projectlombok:lombok:1.18.24'
	testAnnotationProcessor 'org.projectlombok:lombok:1.18.24'

    constraints {
        implementation("org.apache.logging.log4j:log4j-core") {
            version {
                strictly("[2.17, 3[")
                prefer("2.17.1")
            }
            because("CVE-2021-44228: Log4j vulnerable to remote code execution")
        }
    }
    
    components {
        withModule('org.springframework:spring-beans') {
            allVariants {
                withDependencyConstraints {
                    // Need to patch constraints because snakeyaml is an optional dependency
                    it.findAll { it.name == 'snakeyaml' }.each { it.version { strictly '1.19' } }
                }
            }
        }
    }

    configurations {
        all {
            exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
		    //Dont cache snapshots
    		resolutionStrategy.cacheChangingModulesFor 0, 'seconds'
        }
    }

}
  
application {
    // Define the main class for the application.
    mainClass = 'com.orbital3d.server.fnet.ServerApplication'
}

tasks.named('test') {
    // Use JUnit Platform for unit tests.
    useJUnitPlatform()
}

bootJar {
	classifier = 'boot'
	manifest {
		attributes(
			'FNet-Version':project.version
		)
	}
	exclude("**/META-INF/MANIFEST.MF")
	exclude("**/fnet/test.html")
	exclude("**/fnet/style.html")
	exclude("**/sql")
}
